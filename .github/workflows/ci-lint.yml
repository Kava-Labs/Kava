name: Lint Checks
on:
  workflow_call:

permissions:
  # Optional: allow write access to checks to allow the action to annotate code in the PR.
  checks: write

# run per commit ci checks against this commit
jobs:
  proto-lint:
    uses: ./.github/workflows/proto.yml
  golangci-lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 2
      - name: Get changed files
        id: changed-files
        uses: tj-actions/changed-files@v44
        with:
          files: |
            *.go

      - name: List all changed files
        env:
          ALL_CHANGED_FILES: ${{ steps.changed-files.outputs.all_changed_files }}
        run: |
          for file in ${ALL_CHANGED_FILES}; do
            echo "$file was changed"
          done
      

      - name: Load Version
        id: load-version
        run: |
          echo "GOLANGCI_VERSION=v$(cat .golangci-version)"

      - name: golangci-lint
        uses: golangci/golangci-lint-action@v6
        with:
          version: ${{ steps.load-version.outputs.GOLANGCI_VERSION }}
          args: --timeout 30m --verbose --allow-parallel-runners --max-same-issues 0 --max-issues-per-linter 0
          working-directory: ${{ github.workspace }}
        if: |
          contains(steps.changed-files.outputs.all_changed_files, '.go')
